!function(t){var e={};function n(n){var a=this,i=t(n),o=i.find("img"),r={nScale:1,imgWidth:0,imgHeight:0,left:0,top:0,centerX:0,centerY:0,rotate:0};a.changeImage=function(e,n){o.length<1&&i.append(o=t("<img/>")),"string"==typeof e&&(e={src:e}),e&&e.src&&o.attr("src",e.src),a.getImageSize((function(t,i){return r.imgWidth=t,r.imgHeight=i,e&&!1===e.isResetScale?(a.setScale(r.nScale),a.computeCenter()):a.initStartPosition(!!e&&e.autoZoom),n&&n(o,t,i)}))},a.initStartPosition=function(t){t=!!t||e.autoZoom;var n=r.bWidth=i.width(),s=r.bHeight=i.height(),c=r.imgWidth,l=r.imgHeight,u=a.buildScale(Math.min(n/c,s/l));(u>=1||!t)&&(u=1),r.left=.5*(n-c*u),r.top=.5*(s-l*u),o.css({width:c*u,height:l*u,left:r.left,top:r.top}),u!=r.nScale&&(r.nScale=u,a.onScale()),a.computeCenter()},a.computeCenter=function(t){r.centerX=r.left+r.imgWidth*r.nScale*.5,r.centerY=r.top+r.imgHeight*r.nScale*.5},a.onScale=function(){return r.$btns&&r.$btns.length>0&&r.$btns.find(".imgzoom-btns-scale").text(r.nScale),e.onScale&&e.onScale(r.nScale)},a.imageToImage=function(t){var e=new Image;e.crossOrigin="Anonymous",e.onload=function(){return t&&t(e)},e.onerror=function(e){return t&&t(null,e)},e.src=o.attr("src")},a.imageToBase64=function(t,e){a.imageToImage((function(n,a){if(!n)return t&&t({code:-1,message:"load image fail."});var i=document.createElement("canvas");if(!0===e||!1===e){i.width=n.height,i.height=n.width,(r=i.getContext("2d")).clearRect(0,0,i.width,i.height),r.save(),r.translate(i.width/2,i.height/2);var o=(!1!==e?90:-90)*(Math.PI/180);r.rotate(o),r.translate(-n.width/2,-n.height/2),r.drawImage(n,0,0,n.width,n.height),r.restore()}else{var r;i.width=n.width,i.height=n.height,(r=i.getContext("2d")).drawImage(n,0,0,n.width,n.height)}return base64Image=i.toDataURL("image/png"),!base64Image||base64Image.length<6?t&&t({code:-2,message:"image to base64 fail."}):t&&t({code:1,data:base64Image,message:"success."})}))},a.onRotate=function(){var t=a.rotateToTransform();return r.$btns&&r.$btns.length>0&&r.$btns.find(".imgzoom-btns-rotate").text(t),e.onRotate&&e.onRotate(t,r.rotate)},a.getImageSize=function(t){var e=o.attr("src");if(!e||e.length<1)return t&&t(o,0,0);var n=o.clone();n.css("width","auto").css("height","auto").appendTo(document.body),n.attr("style","position: fixed;top:999999px;left:999999px;z-index:-1;").bind("load error",(function(){t&&t(n.width()||0,n.height()||0),n.remove()}))},a.setBoxSize=function(t,e){t&&i.css("width",t),e&&i.css("height",e)},a.setScale=function(t){r.nScale=a.buildScale(t),a.addScale(!0,0)},a.buildScale=function(t){var n=e.scale;return n?(t=parseFloat(Number(isNaN(t)?1:t).toFixed(2)),Math.max(n.min,Math.min(t,n.max))):t},a.addScale=function(t,e){if(e=Number(isNaN(e)?0:Math.max(e,0)),r.nScale+=t?e:-e,r.nScale=a.buildScale(r.nScale),r.left=r.centerX-r.imgWidth*r.nScale*.5,r.top=r.centerY-r.imgHeight*r.nScale*.5,o.css({width:r.imgWidth*r.nScale,height:r.imgHeight*r.nScale,left:isNaN(r.left)?0:r.left,top:isNaN(r.top)?0:r.top}),0!=e)return a.onScale()},a.initBtns=function(){i.find(".imgzoom-btns").remove();var n,o=[];o.push('<div class="imgzoom-btns" style="position: absolute;right: 0;z-index: 2;">');var s="background: #fff;border-left:1px solid #bbb;width: 26px;user-select:none;text-align: center;cursor: pointer;font-size: 12px;height: 18px;line-height: 18px;overflow: hidden;white-space: nowrap;";if(e.scale&&e.scale.enabled&&e.scale.btns&&(n=!0,o.push('<div style="display: flex;margin:4px;border: 1px solid #bbb;border-radius:2px;">'),o.push('<div class="imgzoom-btns-left" style="'+s+';">-</div>'),o.push('<div class="imgzoom-btns-scale" style="'+s+';cursor: default;">1</div>'),o.push('<div class="imgzoom-btns-right" style="'+s+';">+</div>'),o.push("</div>")),e.rotate&&e.rotate.enabled&&e.rotate.btns&&(n=!0,o.push('<div style="display: flex;margin:4px;border: 1px solid #bbb;border-radius:2px;">'),o.push('<div class="imgzoom-btns-left2" style="'+s+';">L</div>'),o.push('<div class="imgzoom-btns-rotate" style="'+s+';cursor: default;">0</div>'),o.push('<div class="imgzoom-btns-right2" style="'+s+';">R</div>'),o.push("</div>")),o.push("</div>"),n){var c=r.$btns=t(o.join(" \n ")).appendTo(i);c.children("div").children("div:first-child").css("border","none"),c.children("div").children("div").bind("click",(function(){var e=t(this);(e.hasClass("imgzoom-btns-left")||e.hasClass("imgzoom-btns-right"))&&a.addScale(e.hasClass("imgzoom-btns-right"),.1),(e.hasClass("imgzoom-btns-left2")||e.hasClass("imgzoom-btns-right2"))&&a.rotate(e.hasClass("imgzoom-btns-right2"),.1)}))}},a.rotateToTransform=function(){return 90*r.rotate%360},a.rotate=function(t){if(e.rotate&&e.rotate.enabled){!1!==t?r.rotate++:r.rotate--,a.onRotate();var n=function(){o.css("transform","rotate("+a.rotateToTransform()+"deg)").css("transition","transform 0.5s ease-in-out"),a.computeCenter()};if(e.rotate&&!1!==e.rotate.onlyUseH5)return n();a.imageToBase64((function(e){if(!e||1!=e.code)return n();o.css("transform","rotate("+(t?"-90":"90")+"deg)").css("transition","none"),a.changeImage({src:e.data,isResetScale:!1},(function(){o.css("transform","rotate("+(t?"0":"-0")+"deg)").css("transition","transform 0.5s ease-in-out")}))}),t)}},a.isDrag=function(){return e.drag&&e.drag.enabled},a.isScale=function(){return e.scale&&e.scale.enabled},a.isRotate=function(){return e.rotate&&e.rotate.enabled},a.addImageEventListener=function(e,n){var r,s=function(t){r||(r=t.type),r==t.type&&c(t,"start")},c=function(t,i){if("mousedown"==r&&(1===t.which||0===t.button)&&a.isDrag())return e(!0,t,i);if("touchstart"==r){var o=t.originalEvent?t.originalEvent.touches:null;if(!o||o.length<1)return;return 1===o.length&&a.isDrag()?e(!1,t,i):!(2!==o.length||!a.isScale()&&!a.isRotate())&&n(!1,t,i)}return!1},l=function(t){if(r)return c(t,"move")?function(t){return t.stopPropagation?t.stopPropagation():t.preventDefault&&t.preventDefault(),t.returnValue=!1}(t):void 0},u=function(t){r&&c(t,"end")};a.isDrag()&&(o.on("mousedown",s),t(document).on("mousemove",l).on("mouseup",u)),a.isScale()&&i.bind("mousewheel wheel",a.mouseWheelEventMove),(a.isDrag()||a.isScale()||a.isRotate())&&i.on("touchstart",s).on("touchmove",l).on("touchend",u)},a.initImageEventListener=function(){if(a.isDrag()||a.isScale()||a.isRotate()){a.initBtns();var t=function(t,e){var n=t["page"+e];return void 0!==n?n:t.originalEvent&&t.originalEvent.touches&&t.originalEvent.touches.length>0?t.originalEvent.touches[0]["client"+e]:0},n=function(t){var e=(t=t.originalEvent||t).touches[0],n=t.touches[1];return Math.sqrt(Math.pow(n.pageX-e.pageX,2)+Math.pow(n.pageY-e.pageY,2))},i=function(t){var e=(t=t.originalEvent||t).touches[0],n=t.touches[1],a=n.pageX-e.pageX,i=n.pageY-e.pageY;return Math.atan2(i,a)*(180/Math.PI)},s={};a.addImageEventListener((function(n,i,c){if("start"==c)return s.dragStart=!0,s.sX=t(i,"X"),s.sY=t(i,"Y"),s.sImgX=r.left,s.sImgY=r.top,!0;if("move"==c){if(!s.dragStart)return!1;var l=s.sImgY+t(i,"Y")-s.sY,u=s.sImgX+t(i,"X")-s.sX;if(-1!=e.drag.overflowX){var g=e.drag.overflowX||0,d=g?r.imgWidth*r.nScale:0;u=Math.min(Math.max(u,g),r.bWidth-g-d)}if(-1!=e.drag.overflowY){var m=e.drag.overflowY||0,h=m?r.imgHeight*r.nScale:0;l=Math.min(Math.max(l,m),r.bHeight-m-h)}return o.css({left:u,top:l}),!0}return"end"==c?!!s.dragStart&&(s.dragStart=!1,r.left=parseInt(o.css("left")),r.top=parseInt(o.css("top")),a.computeCenter(),!0):void 0}),(function(t,e,o){if(!t){t:if(a.isRotate()){if("start"==o){s.rotateStart=!0,s.startAngle=i(e);break t}if("move"==o){if(!s.rotateStart)break t;var c=i(e),l=c-s.startAngle;(l>=30||l<=-30)&&(s.startAngle=c,a.rotate(l>0));break t}if("end"==o){if(!s.rotateStart)return!1;s.rotateStart=!1,s.startAngle=null;break t}}if(a.isScale()){if("start"==o)return s.scaleStart=!0,s.lastScale=r.nScale,s.startDistance=n(e),!0;if("move"==o){if(!s.scaleStart)return!1;var u=n(e),g=u/s.startDistance;return s.lastScale*=g,a.setScale(s.lastScale),r.nScale!=s.lastScale&&a.onScale(),s.startDistance=u,!0}if("end"==o)return!!s.scaleStart&&(s.scaleStart=!1,s.lastScale=r.nScale,s.startDistance=null,!0)}return!!s.rotateStart||void 0}}))}},a.mouseWheelEventMove=function(t){var n=t.originalEvent?t.originalEvent.deltaY||-t.originalEvent.wheelDelta||t.originalEvent.detail:0;return a.addScale(n<=0,Math.max(e.scale?e.scale.step:0,.01)),t.preventDefault?t.preventDefault():t.returnValue=!1},i.bind("changeImage",(function(t,e,n){a.changeImage(e,n)})),i.bind("getImageSize",(function(t,e){a.getImageSize((function(t,n){return e&&e(o,t,n)}))})),i.bind("setBoxSize",(function(t,e,n){a.setBoxSize(e,n)})),i.bind("imageToBase64",(function(t,e){a.imageToBase64(e)})),i.bind("setScale",(function(t,e){a.setScale(e),r.nScale!=e&&a.onScale()})),i.bind("getScale",(function(t,e){var n=parseFloat(Number(100*r.nScale).toFixed(2));return e&&e(n+"%",n)})),i.bind("rotate",(function(t,e){a.rotate(e)})),i.bind("getRotate",(function(t,e){return e&&e(a.rotateToTransform())})),a.setBoxSize(e.width,e.height),i.css({position:"relative",overflow:"hidden"}),a.changeImage({src:e.src,autoZoom:e.autoZoom},(function(){return o.css({position:"absolute",display:"block","-webkit-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none","z-index":1}),a.initImageEventListener(),e.success&&e.success(i)}))}t.fn.imgzoom=function(a,i){if((e=t.extend({src:"",width:"",height:"",scale:{enabled:!0,min:.1,step:.1,max:10,btns:!0},drag:{enabled:!0,overflowX:-1,overflowY:-1},rotate:{enabled:!0,onlyUseH5:!0,btns:!0},success:null},a)).scale){var o=e.scale;o.min=!o.min||isNaN(o.min)||o.min<=0?.1:parseFloat(o.min),o.max=!o.max||isNaN(o.max)||o.max<=0?1:parseFloat(o.max),o.step=!o.step||isNaN(o.step)||o.step<=.01?.1:parseFloat(o.step)}return e.success=e.success||i,this.each((function(){new n(this)}))},t.imgzoom=function(e,n){if(!e||!e.elem)throw new Error("elem is not defined.");t(e.elem).imgzoom(e,n)}}(jQuery);